(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[931],{6385:function(e,t,r){Promise.resolve().then(r.bind(r,7150))},7150:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return u}});var n=r(7437),i=r(2265),s=r(3679),a=r(7934);let c=e=>{var t,r,c,l;let{onOutcomeDetermined:o,className:d=""}=e,[u,m]=(0,i.useState)(null),[h,v]=(0,i.useState)({currentStage:"mission_briefing",userProfile:{traits:{pragmatist:0,mystic:0,idealist:0,cynic:0,risk_taker:0,cautious:0,leader:0,analyst:0},choices:[],path:["mission_briefing"],flags:[]},completedStages:[],chronoTokens:3,unlockedOutcomes:[]}),[f,p]=(0,i.useState)(!1),[g,x]=(0,i.useState)(!1),[w,j]=(0,i.useState)(null);(0,i.useEffect)(()=>{(async()=>{try{var e,t;let r=await fetch("/data/narrative_tree.json",{cache:"no-store"});if(!r.ok)throw Error("Failed to load narrative tree: ".concat(r.status));let n=await r.json();m(n),(null===(t=n.tokens)||void 0===t?void 0:null===(e=t.chrono)||void 0===e?void 0:e.start)&&v(e=>({...e,chronoTokens:n.tokens.chrono.start}))}catch(e){console.error("Narrative tree loading failed:",e),j("Narrative content unavailable")}})()},[]);let k=null==u?void 0:null===(t=u.nodes)||void 0===t?void 0:t.find(e=>e.id===h.currentStage),N=(0,i.useCallback)(e=>!e||0===e.length||e.every(e=>{var t;return null===(t=h.userProfile.flags)||void 0===t?void 0:t.includes(e)}),[h.userProfile.flags]),P=(0,i.useCallback)((e,t,r)=>{var n;let i=null!==(n=e.userProfile.traits[t])&&void 0!==n?n:0;return{...e,userProfile:{...e.userProfile,traits:{...e.userProfile.traits,[t]:Math.max(0,Math.min(100,i+r))}}}},[]),S=(0,i.useCallback)((e,t)=>{let r={...e},n=t.label.toLowerCase(),i=t.id.toLowerCase();return n.includes("risk")||n.includes("danger")||n.includes("bold")||i.includes("intervention")?r=P(r,"risk_taker",2):(n.includes("safe")||n.includes("caution")||n.includes("careful")||i.includes("diplomatic"))&&(r=P(r,"cautious",2)),(n.includes("lead")||n.includes("command")||n.includes("direct")||i.includes("leader"))&&(r=P(r,"leader",2)),(n.includes("analyze")||n.includes("study")||n.includes("research")||i.includes("scientific"))&&(r=P(r,"analyst",2)),(n.includes("intuition")||n.includes("feel")||n.includes("sense")||i.includes("anomaly"))&&(r=P(r,"mystic",2)),(n.includes("practical")||n.includes("logical")||n.includes("efficient"))&&(r=P(r,"pragmatist",2)),(n.includes("hope")||n.includes("believe")||n.includes("principle"))&&(r=P(r,"idealist",2)),(n.includes("doubt")||n.includes("skeptic")||n.includes("question"))&&(r=P(r,"cynic",2)),r},[P]),y=(0,i.useCallback)(()=>{let e=h.userProfile.traits;return Object.keys(e).reduce((t,r)=>e[t]>e[r]?t:r)},[h.userProfile.traits]),b=(0,i.useCallback)(async e=>{var t;if(f||!N(e.requires)||e.cost&&h.chronoTokens<e.cost)return;p(!0);let r={eventType:"choice_made",stageId:h.currentStage,choiceText:e.label,traits:null===(t=e.grants)||void 0===t?void 0:t.filter(e=>e.startsWith("trait_")),timestamp:new Date().toISOString(),userId:"local_user"},n=JSON.parse(localStorage.getItem("atlas-analytics")||"[]");n.push(r),localStorage.setItem("atlas-analytics",JSON.stringify(n.slice(-100))),setTimeout(()=>{var t,r,i,s,a;let c={...h};null===(t=e.grants)||void 0===t||t.forEach(e=>{if(e.startsWith("trait_")){let t=e.replace("trait_","");c=P(c,t,12)}}),c=S(c,e);let l=[...h.userProfile.flags||[]];null===(r=e.grants)||void 0===r||r.forEach(e=>{e.startsWith("trait_")||l.includes(e)||l.push(e)});let d=Math.max(0,h.chronoTokens-(e.cost||0));v({currentStage:e.next_id,userProfile:{...c.userProfile,choices:[...h.userProfile.choices,e],path:[...h.userProfile.path,e.next_id],flags:l},completedStages:[...h.completedStages,h.currentStage],chronoTokens:d,unlockedOutcomes:h.unlockedOutcomes});let m=null==u?void 0:null===(i=u.nodes)||void 0===i?void 0:i.find(t=>t.id===e.next_id);if((null==m?void 0:m.cinematic)&&o&&o({animation_key:m.cinematic.animation_key,view:m.cinematic.view,seek_pct:null===(s=m.cinematic.timeline)||void 0===s?void 0:s.seek_pct,date:null===(a=m.cinematic.timeline)||void 0===a?void 0:a.date,fx:m.cinematic.fx}),!(null==m?void 0:m.choices)||0===m.choices.length){let t={eventType:"outcome_reached",stageId:e.next_id,timestamp:new Date().toISOString(),userId:"local_user"};n.push(t),localStorage.setItem("atlas-analytics",JSON.stringify(n.slice(-100)))}p(!1)},400)},[f,N,h,u,o]),_=(0,i.useCallback)(e=>{h.chronoTokens>0&&v(t=>({...t,currentStage:e,chronoTokens:t.chronoTokens-1}))},[h.chronoTokens]);if(w)return(0,n.jsx)("div",{className:"atlas-directive ".concat(d),children:(0,n.jsx)("div",{className:"narrative-error",children:(0,n.jsxs)("div",{className:"error-content",children:[(0,n.jsx)("h3",{children:"⚠️ System Status"}),(0,n.jsx)("p",{children:w})]})})});if(!u||!k)return(0,n.jsx)("div",{className:"atlas-directive ".concat(d),children:(0,n.jsxs)("div",{className:"loading-state",children:[(0,n.jsx)("div",{className:"loading-spinner",children:(0,n.jsx)("div",{className:"orbit-animation"})}),(0,n.jsx)("p",{children:"Initializing ATLAS Directive..."})]})});let C=!k.choices||0===k.choices.length;return(0,n.jsxs)("div",{className:"atlas-directive ".concat(d," ").concat(f?"transitioning":""),children:[(0,n.jsxs)("div",{className:"narrative-panel",children:[(0,n.jsxs)("div",{className:"stage-header",children:[(0,n.jsx)("h2",{className:"stage-title ".concat(null===(r=k.title)||void 0===r?void 0:r.toLowerCase().replace(/\s+/g,"-")),children:k.title}),k.id.includes("fatal")&&(0,n.jsx)("div",{className:"error-indicator",children:"⚠️ ANALYSIS ERROR"})]}),(0,n.jsxs)("div",{className:"stage-content",children:[(0,n.jsx)("div",{className:"stage-text",children:(0,n.jsx)(s.UG,{rehypePlugins:[a.Z],children:null!==(l=k.body_md)&&void 0!==l?l:""})}),k.choices&&k.choices.length>0&&(0,n.jsx)("div",{className:"choices-container",children:k.choices.map((e,t)=>{var r;let i=N(e.requires),s=!e.cost||h.chronoTokens>=e.cost,a=i&&s&&!f;return(0,n.jsxs)("button",{className:"choice-button ".concat(a?"":"disabled"," ").concat((null===(r=e.grants)||void 0===r?void 0:r.filter(e=>e.startsWith("trait_")).join(" "))||""),onClick:()=>a&&b(e),disabled:!a,title:i?s?"":"Requires ".concat(e.cost," tokens"):"Requirements not met",children:[(0,n.jsx)("div",{className:"choice-text",children:e.label}),e.cost&&(0,n.jsxs)("div",{className:"choice-cost",children:["⧗ ",e.cost]}),e.requires&&(0,n.jsxs)("div",{className:"choice-requirements",children:["Requires: ",e.requires.join(", ")]})]},e.id||t)})}),C&&(0,n.jsx)("div",{className:"ending-state",children:(0,n.jsxs)("div",{className:"outcome-complete",children:[(0,n.jsx)("h3",{children:"\uD83C\uDFAF Mission Status: Complete"}),(0,n.jsx)("p",{children:"Analysis concluded. Final directive achieved."})]})})]})]}),(0,n.jsxs)("div",{className:"ui-sidebar",children:[(0,n.jsxs)("div",{className:"token-display",children:[(0,n.jsx)("h4",{children:"Chrono Tokens"}),(0,n.jsxs)("div",{className:"token-count",children:["⧗".repeat(h.chronoTokens),(0,n.jsx)("span",{className:"token-number",children:h.chronoTokens})]})]}),(0,n.jsxs)("div",{className:"analysis-section",children:[(0,n.jsxs)("button",{className:"analysis-toggle",onClick:()=>x(!g),children:["Psychological Analysis ",g?"▼":"▶"]}),g&&(0,n.jsxs)("div",{className:"trait-analysis",children:[(0,n.jsx)("div",{className:"dominant-trait",children:(0,n.jsxs)("strong",{children:["Primary: ",y().replace("_"," ")]})}),(0,n.jsx)("div",{className:"trait-bars",children:Object.entries(h.userProfile.traits).sort((e,t)=>{let[,r]=e,[,n]=t;return n-r}).slice(0,4).map(e=>{let[t,r]=e;return(0,n.jsxs)("div",{className:"trait-bar",children:[(0,n.jsxs)("div",{className:"trait-label",children:[t.replace("_"," "),(0,n.jsxs)("span",{className:"trait-score",children:[r,"%"]})]}),(0,n.jsx)("div",{className:"progress-track",children:(0,n.jsx)("div",{className:"progress-fill trait-".concat(t),style:{width:"".concat(r,"%")}})})]},t)})})]})]}),(0,n.jsxs)("div",{className:"mission-stats",children:[(0,n.jsx)("h4",{children:"Mission Progress"}),(0,n.jsxs)("div",{className:"stat-row",children:[(0,n.jsx)("span",{children:"Decisions:"}),(0,n.jsx)("span",{children:h.userProfile.choices.length})]}),(0,n.jsxs)("div",{className:"stat-row",children:[(0,n.jsx)("span",{children:"Path Depth:"}),(0,n.jsx)("span",{children:h.userProfile.path.length})]}),(0,n.jsxs)("div",{className:"stat-row",children:[(0,n.jsx)("span",{children:"Flags:"}),(0,n.jsx)("span",{children:(null===(c=h.userProfile.flags)||void 0===c?void 0:c.length)||0})]})]}),h.chronoTokens>0&&h.completedStages.length>0&&(0,n.jsx)("button",{className:"chrono-button",onClick:()=>{_(h.completedStages[h.completedStages.length-1])},children:"⧗ Use Chrono Token"})]}),f&&(0,n.jsx)("div",{className:"transition-overlay",children:(0,n.jsxs)("div",{className:"processing-indicator",children:[(0,n.jsxs)("div",{className:"orbit-loader",children:[(0,n.jsx)("div",{className:"orbit-ring"}),(0,n.jsx)("div",{className:"orbit-dot"})]}),(0,n.jsx)("p",{children:"Processing directive..."})]})})]})};var l=r(1448),o=r(2691);let d=e=>{let{startDate:t="2025-10-01",endDate:r="2025-10-31",stepSize:s="6h",autoPlay:a=!0,playbackSpeed:c=1,showOrbitalPath:d=!0,narrativeAction:u,onAnimationComplete:m,className:h=""}=e,v=(0,i.useRef)(null),f=(0,i.useRef)(),p=(0,i.useRef)(),g=(0,i.useRef)(),x=(0,i.useRef)(),w=(0,i.useRef)(),j=(0,i.useRef)({frameCount:0,lastTime:0,fps:60,lowPerformanceStart:0,pixelRatio:1.5}),k=(0,i.useRef)(),N=(0,i.useRef)();(0,i.useRef)();let P=(0,i.useRef)({}),[S,y]=(0,i.useState)(null),[b,_]=(0,i.useState)("default"),[C,R]=(0,i.useState)(!1),M=(0,i.useMemo)(()=>({default:{position:new l.Pa4(0,10,30),target:new l.Pa4(0,0,0),fov:50},followComet:{position:new l.Pa4(5,3,8),target:new l.Pa4(0,0,0),fov:45},topDown:{position:new l.Pa4(0,50,0),target:new l.Pa4(0,0,0),fov:60},closeup:{position:new l.Pa4(2,1,3),target:new l.Pa4(0,0,0),fov:35},rideComet:{position:new l.Pa4(.5,.2,.8),target:new l.Pa4(0,0,0),fov:40}}),[]);(0,i.useEffect)(()=>{if(!v.current)return;let e=new l.xsS;e.background=new l.Ilk(657930),f.current=e;let t=new l.cPb(50,v.current.clientWidth/v.current.clientHeight,.1,1e3);t.position.set(0,10,30),g.current=t;let r=new l.CP7({antialias:!0});r.setSize(v.current.clientWidth,v.current.clientHeight);let n=Math.min(window.devicePixelRatio,1.5);j.current.pixelRatio=n,r.setPixelRatio(n),r.shadowMap.enabled=!0,r.shadowMap.type=l.ntZ,p.current=r,v.current.appendChild(r.domElement);let i=new l.Mig(4210752,.4);e.add(i);let s=new l.cek(16777096,2,100);s.position.set(0,0,0),s.castShadow=!0,e.add(s);let a=new l.xo$(1,32,32),c=new l.vBJ({color:16776960}),d=new l.Kj0(a,c);e.add(d),k.current=d;let u=new l.xo$(1.2,32,32),m=new l.vBJ({color:16776960,transparent:!0,opacity:.3,side:l._Li}),h=new l.Kj0(u,m);e.add(h),P.current.glow=h;let y=new l.xo$(.1,16,16),b=new l.xoR({color:65535,emissive:17476,shininess:100}),_=new l.Kj0(y,b);_.position.set(10,0,0),_.castShadow=!0,e.add(_),N.current=_;let C=new l.VLJ(50,20,3355443,3355443);e.add(C);{let e=new o.z(t,r.domElement);e.enableDamping=!0,e.dampingFactor=.05,e.screenSpacePanning=!1,e.minDistance=5,e.maxDistance=100,e.maxPolarAngle=Math.PI,x.current=e}let R=()=>{let e=performance.now();if(j.current.frameCount++,e>=j.current.lastTime+1e3){if(j.current.fps=Math.round(1e3*j.current.frameCount/(e-j.current.lastTime)),j.current.frameCount=0,j.current.lastTime=e,j.current.fps<30){if(0===j.current.lowPerformanceStart)j.current.lowPerformanceStart=e;else if(e-j.current.lowPerformanceStart>1e3){let e=Math.max(1,j.current.pixelRatio-.5);e!==j.current.pixelRatio&&(j.current.pixelRatio=e,r.setPixelRatio(e),console.log("Performance: Dropping pixel ratio to ".concat(e," for better FPS")))}}else if(j.current.lowPerformanceStart=0,j.current.pixelRatio<1.5){let e=Math.min(1.5,j.current.pixelRatio+.25);e!==j.current.pixelRatio&&(j.current.pixelRatio=e,r.setPixelRatio(e),console.log("Performance: Restoring pixel ratio to ".concat(e)))}}},M=()=>{w.current=requestAnimationFrame(M),R(),x.current&&x.current.update(),S&&E(),r.render(e,t)};return M(),()=>{w.current&&cancelAnimationFrame(w.current),v.current&&r.domElement&&v.current.removeChild(r.domElement),r.dispose()}},[]),(0,i.useEffect)(()=>{if(!u||!f.current||!g.current)return;console.log("Processing narrative action:",u);let{animation_key:e,view:t,seek_pct:r,date:n,fx:i}=u;y({isActive:!0,startTime:Date.now(),duration:2e3,animation_key:e||"default",onComplete:()=>{null==m||m(e||"default"),y(null)}}),t&&t!==b&&T(t),void 0!==r&&D(r),n&&I(n),i&&A(i)},[u,b,m]);let T=e=>{if(!g.current||!x.current)return;let t=M[e];if(!t)return;R(!0),_(e);let r=g.current.position.clone(),n=x.current.target.clone(),i=g.current.fov,s=t.position.clone(),a=t.target.clone();if(("followComet"===e||"rideComet"===e)&&N.current){let e=N.current.position,r=t.position.clone();s=e.clone().add(r),a=e.clone()}let c=Date.now(),o=()=>{let e=Math.min((Date.now()-c)/1500,1),d=H(e);g.current.position.lerpVectors(r,s,d),x.current&&(x.current.target.lerpVectors(n,a,d),x.current.update()),t.fov&&(g.current.fov=l.M8C.lerp(i,t.fov,d),g.current.updateProjectionMatrix()),e<1?requestAnimationFrame(o):R(!1)};o()},D=e=>{console.log("Seeking to ".concat(e,"% of timeline"))},I=e=>{console.log("Seeking to date: ".concat(e)),"2025-10-28"===e&&W()},A=e=>{if(f.current&&N.current){if(e.glow&&P.current.glow){let t="string"==typeof e.glow?e.glow:"#00ffff";P.current.glow.material.color.setStyle(t),P.current.glow.visible=!0;let r=P.current.glow.material;K(r.opacity,.6,1e3,e=>{r.opacity=e})}e.trail&&J()}},E=()=>{if(!S)return;let e=Math.min((Date.now()-S.startTime)/S.duration,1);switch(S.animation_key){case"mission_start":O(e);break;case"perihelion_final":q(e);break;case"first_contact":F(e);break;case"error_state":L(e);break;default:z(e)}if(e>=1){var t;null===(t=S.onComplete)||void 0===t||t.call(S)}},O=e=>{N.current&&N.current.scale.setScalar(1+.1*Math.sin(e*Math.PI))},q=e=>{N.current&&P.current.glow&&P.current.glow.scale.setScalar(1+.3*Math.sin(e*Math.PI*4))},F=e=>{N.current&&N.current.scale.setScalar(1+.2*Math.sin(e*Math.PI*8))},L=e=>{if(!N.current)return;let t=N.current.material,r=new l.Ilk(16729156),n=new l.Ilk(65535);t.color.lerpColors(n,r,Math.sin(e*Math.PI*6))},z=e=>{N.current&&(N.current.rotation.y+=.01)},W=()=>{console.log("Triggering perihelion sequence"),T("closeup"),A({glow:"#ffaa00",trail:!0})},J=()=>{if(!N.current||!f.current)return;let e=new l.u9r,t=new l.nls({color:65535,transparent:!0,opacity:.5}),r=new l.x12(e,t);f.current.add(r),P.current.trail=r},H=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,K=(e,t,r,n)=>{let i=Date.now(),s=()=>{let a=Math.min((Date.now()-i)/r,1);n(l.M8C.lerp(e,t,H(a))),a<1&&requestAnimationFrame(s)};s()};return(0,i.useEffect)(()=>{let e=()=>{if(!v.current||!g.current||!p.current)return;let e=v.current.clientWidth,t=v.current.clientHeight;g.current.aspect=e/t,g.current.updateProjectionMatrix(),p.current.setSize(e,t)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,n.jsxs)("div",{className:"atlas-3d-tracker-enhanced ".concat(h),children:[(0,n.jsx)("div",{ref:v,className:"tracker-canvas-container",style:{width:"100%",height:"100%",position:"relative"}}),S&&(0,n.jsx)("div",{className:"animation-overlay",children:(0,n.jsxs)("div",{className:"animation-info",children:["Animation: ",S.animation_key]})}),C&&(0,n.jsxs)("div",{className:"transition-indicator",children:["Transitioning to ",b," view..."]})]})};function u(){let[e,t]=(0,i.useState)();return(0,n.jsxs)("div",{className:"app-container",children:[(0,n.jsx)("div",{className:"tracker-container",children:(0,n.jsx)(d,{narrativeAction:e,onAnimationComplete:e=>{console.log("Animation completed: ".concat(e)),t(void 0)}})}),(0,n.jsx)("div",{className:"narrative-container",children:(0,n.jsx)(c,{onOutcomeDetermined:e=>{t({...e,timestamp:new Date().toISOString(),source:"narrative_engine"})},className:"narrative-overlay"})})]})}}},function(e){e.O(0,[689,841,244,971,117,744],function(){return e(e.s=6385)}),_N_E=e.O()}]);